{{ if eq .chezmoi.os "windows" }}

# Check if the execution policy is already set to Unrestricted, if not, set it
$currentPolicy = Get-ExecutionPolicy -Scope LocalMachine
if ($currentPolicy -ne 'Unrestricted') {
    Write-Host "Setting execution policy to Unrestricted"
    Set-ExecutionPolicy Unrestricted -Scope LocalMachine -Force
} else {
    Write-Host "Execution policy is already set to Unrestricted"
}

# Check if Chocolatey is installed, if not, install it
if (-not (Get-Command choco -ErrorAction SilentlyContinue)) {
    Write-Host "🍫  Installing Chocolatey"
    Set-ExecutionPolicy Unrestricted -Scope Process -Force;
    [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072;
    iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'));
} else {
    Write-Host "Chocolatey is already installed."
}

{{ end }}