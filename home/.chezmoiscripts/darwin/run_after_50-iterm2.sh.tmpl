{{- if eq .chezmoi.os "darwin" -}}
#!/usr/bin/env bash

set -euo pipefail


# Grab current setting
current="$(defaults read com.googlecode.iterm2 PrefsCustomFolder 2>/dev/null || true)"

if [[ -z "${current}" ]] || [[ "${current}" != "{{ .xdgConfigDir }}/applications/iterm2" ]]; then

    # Specify the preferences directory
    defaults write com.googlecode.iterm2 PrefsCustomFolder -string "{{ .xdgConfigDir }}/applications/iterm2"

    # Tell iTerm2 to use the custom preferences in the directory
    defaults write com.googlecode.iterm2 LoadPrefsFromCustomFolder -bool true

    echo "Set shared iTerm2 preferences: {{ .xdgConfigDir }}/applications/iterm2"
fi

{{- end }}
