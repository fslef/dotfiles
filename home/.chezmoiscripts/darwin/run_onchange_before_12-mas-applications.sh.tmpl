{{- if eq .chezmoi.os "darwin" -}}
#!/usr/bin/env bash

set -euo pipefail

apps=(
    {{ range $package := .packages.mas.common.apps }}
    "{{ $package }}"
    {{ end }}

    {{ if .personal_computer }}
    {{ range $package := .packages.mas.personal_computer.apps }}
    "{{ $package }}"
    {{ end }}
    {{ end }}

    {{ if .work_computer }}
    {{ range $package := .packages.mas.work_computer.apps }}
    "{{ $package }}"
    {{ end }}
    {{ end }}

    {{ if .dev_computer }}
    {{ range $package := .packages.mas.dev_computer.apps }}
    "{{ $package }}"
    {{ end }}
    {{ end }}
)

if command -v mas >/dev/null 2>&1; then
    echo
    echo -e "\033[0;36mInstalling Applications from mas\033[0m"
    echo -e "\033[0;36m--------------------------------\033[0m"

    installed_ids="$(mas list | awk '{print $1}')"

    for app in "${apps[@]}"; do
        if grep -Fxq "${app}" <<<"${installed_ids}"; then
            continue
        fi
        mas install "${app}"
    done
fi

{{- end }}
