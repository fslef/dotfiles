#!/usr/bin/env sh

# Load aliases from ChezMoi data.
# This file is intended to be sourced by interactive shells.
load_aliases() {
    set_alias() {
        name="$1"
        value="$2"

        # Always (re)define to ensure consistent behavior across shells.
        unalias "$name" >/dev/null 2>&1 || true
        unset -f "$name" >/dev/null 2>&1 || true

        # Single quotes prevent expansion (e.g., $(...) ) at load time.
        # Values come from templates, already safely quoted.
        eval "alias ${name}='${value}'"
    }

    {{- /* Common aliases */ -}}
    {{- range $key, $value := .aliases.common }}
    {{- $escaped := replace $value "'" "'\\''" -}}
    set_alias "{{ $key }}" "{{ $escaped }}"
    {{- end }}

    {{- /* Environment-specific aliases */ -}}
    {{- if .personal_computer }}
    {{- range $key, $value := .aliases.personal_computer }}
    {{- $escaped := replace $value "'" "'\\''" -}}
    set_alias "{{ $key }}" "{{ $escaped }}"
    {{- end }}
    {{- end }}

    {{- if .work_computer }}
    {{- range $key, $value := .aliases.work_computer }}
    {{- $escaped := replace $value "'" "'\\''" -}}
    set_alias "{{ $key }}" "{{ $escaped }}"
    {{- end }}
    {{- end }}

    {{- if .dev_computer }}
    {{- range $key, $value := .aliases.dev_computer }}
    {{- $escaped := replace $value "'" "'\\''" -}}
    set_alias "{{ $key }}" "{{ $escaped }}"
    {{- end }}
    {{- end }}

    {{- if .docker_computer }}
    {{- range $key, $value := .aliases.docker_computer }}
    {{- $escaped := replace $value "'" "'\\''" -}}
    set_alias "{{ $key }}" "{{ $escaped }}"
    {{- end }}
    {{- end }}
}

load_aliases
unset -f load_aliases >/dev/null 2>&1 || true