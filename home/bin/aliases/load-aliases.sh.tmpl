#!/usr/bin/env sh

# Load aliases from ChezMoi data.
# This file is intended to be sourced by interactive shells.
load_aliases() {
    # Skip if an alias/function with this name already exists.
    alias_or_function_exists() {
        alias "$1" >/dev/null 2>&1 && return 0
        typeset -f "$1" >/dev/null 2>&1 && return 0
        return 1
    }

    set_alias() {
        name="$1"
        value="$2"

        if alias_or_function_exists "$name"; then
            return 0
        fi

        # Single quotes prevent expansion (e.g., $(...) ) at load time.
        # Values come from templates, already safely quoted.
        eval "alias ${name}='${value}'"
    }

    {{- /* Common aliases */ -}}
    {{- range $key, $value := .aliases.common }}
    {{- $escaped := replace $value "'" "'\\''" -}}
    set_alias "{{ $key }}" "{{ $escaped }}"
    {{- end }}

    {{- /* Environment-specific aliases */ -}}
    {{- if .personal_computer }}
    {{- range $key, $value := .aliases.personal_computer }}
    {{- $escaped := replace $value "'" "'\\''" -}}
    set_alias "{{ $key }}" "{{ $escaped }}"
    {{- end }}
    {{- end }}

    {{- if .work_computer }}
    {{- range $key, $value := .aliases.work_computer }}
    {{- $escaped := replace $value "'" "'\\''" -}}
    set_alias "{{ $key }}" "{{ $escaped }}"
    {{- end }}
    {{- end }}

    {{- if .dev_computer }}
    {{- range $key, $value := .aliases.dev_computer }}
    {{- $escaped := replace $value "'" "'\\''" -}}
    set_alias "{{ $key }}" "{{ $escaped }}"
    {{- end }}
    {{- end }}

    {{- if .docker_computer }}
    {{- range $key, $value := .aliases.docker_computer }}
    {{- $escaped := replace $value "'" "'\\''" -}}
    set_alias "{{ $key }}" "{{ $escaped }}"
    {{- end }}
    {{- end }}
}

load_aliases
unset -f load_aliases >/dev/null 2>&1 || true