#!/bin/bash

# Function to load aliases from TOML file
load_aliases() {
    local toml_file="$HOME/.chezmoidata/aliases.toml"
    if [ ! -f "$toml_file" ]; then
        echo "Warning: aliases.toml not found at $toml_file"
        return 1
    fi

    # Load common aliases
    if grep -q "\[aliases.common\]" "$toml_file"; then
        sed -n '/\[aliases.common\]/,/^$/p' "$toml_file" | grep -v '^\[.*\]' | grep -v '^$' | while read -r line; do
            if [[ $line =~ ^([^=]+)=(.*)$ ]]; then
                alias "${BASH_REMATCH[1]}"="${BASH_REMATCH[2]}"
            fi
        done
    fi

    # Load environment-specific aliases
    if [ -n "$PERSONAL_COMPUTER" ] && grep -q "\[aliases.personal_computer\]" "$toml_file"; then
        sed -n '/\[aliases.personal_computer\]/,/^$/p' "$toml_file" | grep -v '^\[.*\]' | grep -v '^$' | while read -r line; do
            if [[ $line =~ ^([^=]+)=(.*)$ ]]; then
                alias "${BASH_REMATCH[1]}"="${BASH_REMATCH[2]}"
            fi
        done
    fi

    if [ -n "$WORK_COMPUTER" ] && grep -q "\[aliases.work_computer\]" "$toml_file"; then
        sed -n '/\[aliases.work_computer\]/,/^$/p' "$toml_file" | grep -v '^\[.*\]' | grep -v '^$' | while read -r line; do
            if [[ $line =~ ^([^=]+)=(.*)$ ]]; then
                alias "${BASH_REMATCH[1]}"="${BASH_REMATCH[2]}"
            fi
        done
    fi

    if [ -n "$DEV_COMPUTER" ] && grep -q "\[aliases.dev_computer\]" "$toml_file"; then
        sed -n '/\[aliases.dev_computer\]/,/^$/p' "$toml_file" | grep -v '^\[.*\]' | grep -v '^$' | while read -r line; do
            if [[ $line =~ ^([^=]+)=(.*)$ ]]; then
                alias "${BASH_REMATCH[1]}"="${BASH_REMATCH[2]}"
            fi
        done
    fi

    if [ -n "$DOCKER_COMPUTER" ] && grep -q "\[aliases.docker_computer\]" "$toml_file"; then
        sed -n '/\[aliases.docker_computer\]/,/^$/p' "$toml_file" | grep -v '^\[.*\]' | grep -v '^$' | while read -r line; do
            if [[ $line =~ ^([^=]+)=(.*)$ ]]; then
                alias "${BASH_REMATCH[1]}"="${BASH_REMATCH[2]}"
            fi
        done
    fi
}

# Make the function available to the shell
export -f load_aliases

# Load aliases immediately
load_aliases