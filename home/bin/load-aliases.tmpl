#!/bin/sh

# Function to load aliases from TOML file
load_aliases() {
    local toml_file="$HOME/.chezmoidata/aliases.toml"
    if [ ! -f "$toml_file" ]; then
        echo "Warning: aliases.toml not found at $toml_file"
        return 1
    fi

    # Load common aliases
    if grep -q "\[aliases.common\]" "$toml_file"; then
        sed -n '/\[aliases.common\]/,/^$/p' "$toml_file" | grep -v '^\[.*\]' | grep -v '^$' | while read -r line; do
            if echo "$line" | grep -q '^[^=]\+='; then
                alias_name="${line%%=*}"
                alias_value="${line#*=}"
                alias "$alias_name=$alias_value"
            fi
        done
    fi

    # Load environment-specific aliases
    {{ if .personal_computer }}
    if grep -q "\[aliases.personal_computer\]" "$toml_file"; then
        sed -n '/\[aliases.personal_computer\]/,/^$/p' "$toml_file" | grep -v '^\[.*\]' | grep -v '^$' | while read -r line; do
            if echo "$line" | grep -q '^[^=]\+='; then
                alias_name="${line%%=*}"
                alias_value="${line#*=}"
                alias "$alias_name=$alias_value"
            fi
        done
    fi
    {{ end }}

    {{ if .work_computer }}
    if grep -q "\[aliases.work_computer\]" "$toml_file"; then
        sed -n '/\[aliases.work_computer\]/,/^$/p' "$toml_file" | grep -v '^\[.*\]' | grep -v '^$' | while read -r line; do
            if echo "$line" | grep -q '^[^=]\+='; then
                alias_name="${line%%=*}"
                alias_value="${line#*=}"
                alias "$alias_name=$alias_value"
            fi
        done
    fi
    {{ end }}

    {{ if .dev_computer }}
    if grep -q "\[aliases.dev_computer\]" "$toml_file"; then
        sed -n '/\[aliases.dev_computer\]/,/^$/p' "$toml_file" | grep -v '^\[.*\]' | grep -v '^$' | while read -r line; do
            if echo "$line" | grep -q '^[^=]\+='; then
                alias_name="${line%%=*}"
                alias_value="${line#*=}"
                alias "$alias_name=$alias_value"
            fi
        done
    fi
    {{ end }}

    {{ if .docker_computer }}
    if grep -q "\[aliases.docker_computer\]" "$toml_file"; then
        sed -n '/\[aliases.docker_computer\]/,/^$/p' "$toml_file" | grep -v '^\[.*\]' | grep -v '^$' | while read -r line; do
            if echo "$line" | grep -q '^[^=]\+='; then
                alias_name="${line%%=*}"
                alias_value="${line#*=}"
                alias "$alias_name=$alias_value"
            fi
        done
    fi
    {{ end }}
}

# Load aliases immediately
load_aliases